<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../common/behavior-app-state.html">
<link rel="import" href="../common/shared-styles.html">
<link rel="import" href="../providers/provider-metadata.html">
<link rel="import" href="../providers/provider-tracks.html">
<link rel="import" href="../providers/provider-votes.html">
<link rel="import" href="./components/component-search-bar.html">
<link rel="import" href="./components/component-track.html">

<dom-module id="view-party">
    <template>
        <style include="shared-styles"></style>
        <style>
            app-header-layout {
                overflow-y: scroll;
            }

            app-header {
                background-color: #212121;
                color: white;
                height: auto;
                padding: 0 8px;
            }

            app-header div[sticky] {
                height: 80px;
                padding-top: 16px;
            }

            app-toolbar {
                height: 48px;
                padding: 8px 0 0 0;
            }

            app-toolbar paper-icon-button {
                margin: 12px;
                padding: 0;

                width: 24px;
                height: 24px;

                --paper-icon-button-ink-color: white;
            }

            app-toolbar div[main-title] {
                margin-right: 64px;
                text-align: center;
                flex-grow: 1;
            }

            iron-list {
                background-color: #303030;
            }

            iron-list component-track[playing] {
                background-color: #282828;
                padding: 13px 16px;
                margin: 16px;
            }

            iron-list component-track[playing] + component-track {
                padding-top: 13px;
            }

            component-track[hidden] {
                display: none;
            }
        </style>

        <provider-metadata data="{{meta}}" tracks="[[tracks]]"></provider-metadata>
        <provider-tracks search-query="[[searchQuery]]"
                         state="[[state]]"
                         tracks="{{tracks}}">
        </provider-tracks>
        <provider-votes id="voteProvider" state="[[state]]"></provider-votes>

        <template is="dom-if" if="[[active]]">
            <app-drawer-layout fullbleed>
                <app-drawer>
                    <app-toolbar>Menu</app-toolbar>
                    <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
                    </iron-selector>
                </app-drawer>

                <app-header-layout>
                    <app-header condenses fixed reveals effects="waterfall">
                        <app-toolbar>
                            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                            <div main-title>[[state.party.name]]</div>
                        </app-toolbar>
                        <div sticky>
                            <component-search-bar value="{{searchQuery}}"
                                                  placeholder="Add Tracks">
                            </component-search-bar>
                        </div>
                    </app-header>

                    <iron-list items="[[tracks]]">
                        <template>
                            <component-track index="[[index]]"
                                             metadata="[[meta]]"
                                             state="[[state]]"
                                             track="[[item]]">
                            </component-track>
                        </template>
                    </iron-list>
                </app-header-layout>
            </app-drawer-layout>
        </template>
    </template>
    <script>
        Polymer({
            is: 'view-party',

            behaviors: [FestifyBehaviors.StateBehavior],

            properties: {
                active: {
                    type: Boolean
                },
                route: {
                    type: Object,
                    notify: true
                }
            },

            listeners: {
                'track-toggleVote': '_toggleVote'
            },

            _toggleVote: function (ev) {
                this.$.voteProvider.toggleVote(ev.detail.track);
            }
        });
    </script>
</dom-module>
